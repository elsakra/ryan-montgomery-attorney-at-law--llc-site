---
import { getCollection } from 'astro:content';

interface Props {
  headline?: string;
  description?: string;
  limit?: number;
}

const {
  headline = "Upcoming Events",
  description = "Join us for these upcoming campus events",
  limit = 4
} = Astro.props;

const events = await getCollection('events');
const now = new Date();

// Sort events by date and filter for upcoming
const upcomingEvents = events
  .filter(e => new Date(e.data.date) >= now)
  .sort((a, b) => new Date(a.data.date).getTime() - new Date(b.data.date).getTime())
  .slice(0, limit);

// Format date helper
function formatDate(date: Date): { month: string; day: string; year: string } {
  return {
    month: date.toLocaleDateString('en-US', { month: 'short' }).toUpperCase(),
    day: date.getDate().toString(),
    year: date.getFullYear().toString()
  };
}

// Category colors
const categoryColors: Record<string, string> = {
  'Admissions': 'bg-blue-100 text-blue-700',
  'Ceremony': 'bg-burgundy-100 text-burgundy-700',
  'Community': 'bg-green-100 text-green-700',
  'Arts': 'bg-purple-100 text-purple-700',
  'Athletics': 'bg-orange-100 text-orange-700',
  'default': 'bg-slate-100 text-slate-700'
};
---

<section class="py-16 lg:py-24 bg-slate-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-12">
      <div>
        <h2 class="font-display text-3xl sm:text-4xl font-bold text-slate-900">
          {headline}
        </h2>
        {description && (
          <p class="mt-2 text-slate-600 max-w-2xl">
            {description}
          </p>
        )}
      </div>
      <a 
        href="/events"
        class="inline-flex items-center gap-2 text-burgundy-700 font-medium hover:text-burgundy-800 transition-colors whitespace-nowrap"
      >
        View all events
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>

    {upcomingEvents.length > 0 ? (
      <div class="grid md:grid-cols-2 gap-6">
        {upcomingEvents.map((event) => {
          const dateInfo = formatDate(new Date(event.data.date));
          const colorClass = categoryColors[event.data.category || 'default'] || categoryColors.default;
          
          return (
            <div class="group bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-200 overflow-hidden">
              <div class="flex">
                {/* Date display */}
                <div class="flex-shrink-0 w-24 bg-burgundy-800 text-white flex flex-col items-center justify-center py-6">
                  <span class="text-xs font-medium tracking-wider opacity-80">
                    {dateInfo.month}
                  </span>
                  <span class="text-3xl font-bold">
                    {dateInfo.day}
                  </span>
                </div>
                
                {/* Event details */}
                <div class="flex-1 p-6">
                  {event.data.category && (
                    <span class={`inline-block px-2 py-0.5 text-xs font-medium rounded-full mb-2 ${colorClass}`}>
                      {event.data.category}
                    </span>
                  )}
                  
                  <h3 class="font-display text-lg font-semibold text-slate-900 group-hover:text-burgundy-700 transition-colors">
                    {event.data.title}
                  </h3>
                  
                  {event.data.description && (
                    <p class="mt-2 text-slate-600 text-sm line-clamp-2">
                      {event.data.description}
                    </p>
                  )}
                  
                  <div class="mt-4 flex items-center gap-4 text-sm text-slate-500">
                    {event.data.location && (
                      <span class="flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        {event.data.location}
                      </span>
                    )}
                    
                    {event.data.registrationUrl && (
                      <a 
                        href={event.data.registrationUrl}
                        class="text-burgundy-600 hover:text-burgundy-700 font-medium"
                      >
                        Register →
                      </a>
                    )}
                  </div>
                </div>
              </div>
            </div>
          );
        })}
      </div>
    ) : (
      <div class="text-center py-12 bg-white rounded-xl border border-slate-200">
        <p class="text-slate-600">No upcoming events at this time.</p>
        <a href="/events" class="text-burgundy-600 hover:underline mt-2 inline-block">
          View past events →
        </a>
      </div>
    )}
  </div>
</section>
